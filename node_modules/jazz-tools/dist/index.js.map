{"version":3,"sources":["../src/auth/DemoAuth.ts","../src/auth/PassphraseAuth.ts","../src/implementation/invites.ts","../src/index.ts"],"sourcesContent":["import { AgentSecret } from \"cojson\";\nimport { Account, ID } from \"../internal.js\";\nimport { AuthenticateAccountFunction } from \"../types.js\";\nimport { AuthSecretStorage } from \"./AuthSecretStorage.js\";\nimport { KvStore, KvStoreContext } from \"./KvStoreContext.js\";\n\ntype StorageData = {\n  accountID: ID<Account>;\n  accountSecret: AgentSecret;\n  secretSeed?: number[];\n};\n\n/**\n * `DemoAuth` provides a `JazzAuth` object for demo authentication.\n *\n * Demo authentication is useful for quickly testing your app, as it allows you to create new accounts and log in as existing ones.\n *\n * ```\n * import { DemoAuth } from \"jazz-tools\";\n *\n * const auth = new DemoAuth(jazzContext.authenticate, new AuthSecretStorage());\n * ```\n *\n * @category Auth Providers\n */\nexport class DemoAuth {\n  constructor(\n    private authenticate: AuthenticateAccountFunction,\n    private authSecretStorage: AuthSecretStorage,\n  ) {}\n\n  logIn = async (username: string) => {\n    const existingUsers = await this.getExisitingUsersWithData();\n    const storageData = existingUsers[username];\n\n    if (!storageData?.accountID) {\n      throw new Error(\"User not found\");\n    }\n\n    await this.authenticate({\n      accountID: storageData.accountID,\n      accountSecret: storageData.accountSecret,\n    });\n\n    await this.authSecretStorage.set({\n      accountID: storageData.accountID,\n      accountSecret: storageData.accountSecret,\n      secretSeed: storageData.secretSeed\n        ? new Uint8Array(storageData.secretSeed)\n        : undefined,\n      provider: \"demo\",\n    });\n  };\n\n  signUp = async (username: string) => {\n    const existingUsers = await this.getExistingUsers();\n    if (existingUsers.includes(username)) {\n      throw new Error(\"User already registered\");\n    }\n\n    const credentials = await this.authSecretStorage.get();\n\n    if (!credentials) {\n      throw new Error(\"No credentials found\");\n    }\n\n    const currentAccount = await Account.getMe().ensureLoaded({\n      resolve: {\n        profile: true,\n      },\n    });\n\n    currentAccount.profile.name = username;\n\n    await this.authSecretStorage.set({\n      accountID: credentials.accountID,\n      accountSecret: credentials.accountSecret,\n      secretSeed: credentials.secretSeed\n        ? new Uint8Array(credentials.secretSeed)\n        : undefined,\n      provider: \"demo\",\n    });\n\n    await this.addToExistingUsers(username, {\n      accountID: credentials.accountID,\n      accountSecret: credentials.accountSecret,\n      secretSeed: credentials.secretSeed\n        ? Array.from(credentials.secretSeed)\n        : undefined,\n    });\n  };\n\n  private async addToExistingUsers(username: string, data: StorageData) {\n    const existingUsers = await this.getExisitingUsersWithData();\n\n    if (existingUsers[username]) {\n      return;\n    }\n\n    existingUsers[username] = data;\n\n    const kvStore = KvStoreContext.getInstance().getStorage();\n    await kvStore.set(\"demo-auth-users\", JSON.stringify(existingUsers));\n  }\n\n  private async getExisitingUsersWithData() {\n    const kvStore = KvStoreContext.getInstance().getStorage();\n    await migrateExistingUsers(kvStore);\n\n    const existingUsers = await kvStore.get(\"demo-auth-users\");\n    return existingUsers ? JSON.parse(existingUsers) : {};\n  }\n\n  getExistingUsers = async () => {\n    return Object.keys(await this.getExisitingUsersWithData());\n  };\n}\n\nexport function encodeUsername(username: string) {\n  return btoa(username)\n    .replace(/=/g, \"-\")\n    .replace(/\\+/g, \"_\")\n    .replace(/\\//g, \".\");\n}\n\nasync function getStorageVersion(kvStore: KvStore) {\n  try {\n    const version = await kvStore.get(\"demo-auth-storage-version\");\n    return version ? parseInt(version) : 1;\n  } catch (error) {\n    return 1;\n  }\n}\n\nasync function setStorageVersion(kvStore: KvStore, version: number) {\n  await kvStore.set(\"demo-auth-storage-version\", version.toString());\n}\n\nasync function getExistingUsersList(kvStore: KvStore) {\n  const existingUsers = await kvStore.get(\"demo-auth-existing-users\");\n  return existingUsers ? existingUsers.split(\",\") : [];\n}\n\n/**\n * Migrates existing users keys to work with any storage.\n */\nasync function migrateExistingUsers(kvStore: KvStore) {\n  if ((await getStorageVersion(kvStore)) < 2) {\n    const existingUsers = await getExistingUsersList(kvStore);\n\n    for (const username of existingUsers) {\n      const legacyKey = `demo-auth-existing-users-${username}`;\n      const storageData = await kvStore.get(legacyKey);\n      if (storageData) {\n        await kvStore.set(\n          `demo-auth-existing-users-${encodeUsername(username)}`,\n          storageData,\n        );\n        await kvStore.delete(legacyKey);\n      }\n    }\n\n    await setStorageVersion(kvStore, 2);\n  }\n\n  if ((await getStorageVersion(kvStore)) < 3) {\n    const existingUsersList = await getExistingUsersList(kvStore);\n\n    const existingUsers: Record<string, StorageData> = {};\n    const keysToDelete: string[] = [\"demo-auth-existing-users\"];\n\n    for (const username of existingUsersList) {\n      const key = `demo-auth-existing-users-${encodeUsername(username)}`;\n      const storageData = await kvStore.get(key);\n      if (storageData) {\n        existingUsers[username] = JSON.parse(storageData);\n        keysToDelete.push(key);\n      }\n    }\n\n    await kvStore.set(\"demo-auth-users\", JSON.stringify(existingUsers));\n\n    for (const key of keysToDelete) {\n      await kvStore.delete(key);\n    }\n\n    await setStorageVersion(kvStore, 3);\n  }\n}\n","import * as bip39 from \"@scure/bip39\";\nimport { entropyToMnemonic } from \"@scure/bip39\";\nimport { CryptoProvider, cojsonInternals } from \"cojson\";\nimport type { ID } from \"../internal.js\";\nimport { Account } from \"../internal.js\";\nimport type {\n  AuthenticateAccountFunction,\n  RegisterAccountFunction,\n} from \"../types.js\";\nimport { AuthSecretStorage } from \"./AuthSecretStorage.js\";\n\n/**\n * `PassphraseAuth` provides a `JazzAuth` object for passphrase authentication.\n *\n * ```ts\n * import { PassphraseAuth } from \"jazz-tools\";\n *\n * const auth = new PassphraseAuth(crypto, jazzContext.authenticate, new AuthSecretStorage(), wordlist);\n * ```\n *\n * @category Auth Providers\n */\nexport class PassphraseAuth {\n  passphrase: string = \"\";\n\n  constructor(\n    private crypto: CryptoProvider,\n    private authenticate: AuthenticateAccountFunction,\n    private register: RegisterAccountFunction,\n    private authSecretStorage: AuthSecretStorage,\n    public wordlist: string[],\n  ) {}\n\n  logIn = async (passphrase: string) => {\n    const { crypto, authenticate } = this;\n\n    let secretSeed;\n\n    try {\n      secretSeed = bip39.mnemonicToEntropy(passphrase, this.wordlist);\n    } catch (e) {\n      throw new Error(\"Invalid passphrase\");\n    }\n\n    const accountSecret = crypto.agentSecretFromSecretSeed(secretSeed);\n\n    const accountID = cojsonInternals.idforHeader(\n      cojsonInternals.accountHeaderForInitialAgentSecret(accountSecret, crypto),\n      crypto,\n    ) as ID<Account>;\n\n    await authenticate({\n      accountID,\n      accountSecret,\n    });\n\n    await this.authSecretStorage.set({\n      accountID,\n      secretSeed,\n      accountSecret,\n      provider: \"passphrase\",\n    });\n\n    this.passphrase = passphrase;\n    this.notify();\n  };\n\n  signUp = async (name?: string) => {\n    const credentials = await this.authSecretStorage.get();\n\n    if (!credentials || !credentials.secretSeed) {\n      throw new Error(\"No credentials found\");\n    }\n\n    const passphrase = entropyToMnemonic(credentials.secretSeed, this.wordlist);\n\n    await this.authSecretStorage.set({\n      accountID: credentials.accountID,\n      secretSeed: credentials.secretSeed,\n      accountSecret: credentials.accountSecret,\n      provider: \"passphrase\",\n    });\n\n    if (name?.trim()) {\n      const currentAccount = await Account.getMe().ensureLoaded({\n        resolve: {\n          profile: true,\n        },\n      });\n\n      currentAccount.profile.name = name;\n    }\n\n    return passphrase;\n  };\n\n  registerNewAccount = async (passphrase: string, name: string) => {\n    const secretSeed = bip39.mnemonicToEntropy(passphrase, this.wordlist);\n    const accountSecret = this.crypto.agentSecretFromSecretSeed(secretSeed);\n    const accountID = await this.register(accountSecret, { name });\n\n    await this.authSecretStorage.set({\n      accountID,\n      secretSeed,\n      accountSecret,\n      provider: \"passphrase\",\n    });\n\n    return accountID;\n  };\n\n  getCurrentAccountPassphrase = async () => {\n    const credentials = await this.authSecretStorage.get();\n\n    if (!credentials || !credentials.secretSeed) {\n      throw new Error(\"No credentials found\");\n    }\n\n    return entropyToMnemonic(credentials.secretSeed, this.wordlist);\n  };\n\n  generateRandomPassphrase = () => {\n    return entropyToMnemonic(this.crypto.newRandomSecretSeed(), this.wordlist);\n  };\n\n  loadCurrentAccountPassphrase = async () => {\n    const passphrase = await this.getCurrentAccountPassphrase();\n    this.passphrase = passphrase;\n    this.notify();\n  };\n\n  listeners = new Set<() => void>();\n  subscribe = (callback: () => void) => {\n    this.listeners.add(callback);\n\n    return () => {\n      this.listeners.delete(callback);\n    };\n  };\n\n  notify() {\n    for (const listener of this.listeners) {\n      listener();\n    }\n  }\n}\n","import { type InviteSecret, cojsonInternals } from \"cojson\";\nimport { Account } from \"../coValues/account.js\";\nimport type {\n  CoValue,\n  CoValueClass,\n  CoValueOrZodSchema,\n  ID,\n} from \"../internal.js\";\n\n/** @category Invite Links */\nexport function createInviteLink<C extends CoValue>(\n  value: C,\n  role: \"reader\" | \"writer\" | \"admin\" | \"writeOnly\",\n  baseURL: string,\n  valueHint?: string,\n): string {\n  const coValueCore = value._raw.core;\n  let currentCoValue = coValueCore;\n\n  while (currentCoValue.verified.header.ruleset.type === \"ownedByGroup\") {\n    currentCoValue = currentCoValue.getGroup().core;\n  }\n\n  const { ruleset, meta } = currentCoValue.verified.header;\n\n  if (ruleset.type !== \"group\" || meta?.type === \"account\") {\n    throw new Error(\"Can't create invite link for object without group\");\n  }\n\n  const group = cojsonInternals.expectGroup(currentCoValue.getCurrentContent());\n  const inviteSecret = group.createInvite(role);\n\n  return `${baseURL}#/invite/${valueHint ? valueHint + \"/\" : \"\"}${\n    value.id\n  }/${inviteSecret}`;\n}\n\n/** @category Invite Links */\nexport function parseInviteLink(inviteURL: string):\n  | {\n      valueID: string;\n      valueHint?: string;\n      inviteSecret: InviteSecret;\n    }\n  | undefined {\n  const url = new URL(inviteURL);\n  const parts = url.hash.split(\"/\");\n\n  let valueHint: string | undefined;\n  let valueID: string | undefined;\n  let inviteSecret: InviteSecret | undefined;\n\n  if (parts[0] === \"#\" && parts[1] === \"invite\") {\n    if (parts.length === 5) {\n      valueHint = parts[2];\n      valueID = parts[3];\n      inviteSecret = parts[4] as InviteSecret;\n    } else if (parts.length === 4) {\n      valueID = parts[2];\n      inviteSecret = parts[3] as InviteSecret;\n    }\n\n    if (!valueID || !inviteSecret) {\n      return undefined;\n    }\n    return { valueID, inviteSecret, valueHint };\n  }\n}\n\n/** @category Invite Links */\nexport function consumeInviteLink<S extends CoValueOrZodSchema>({\n  inviteURL,\n  as = Account.getMe(),\n  forValueHint,\n  invitedObjectSchema,\n}: {\n  inviteURL: string;\n  as?: Account;\n  forValueHint?: string;\n  invitedObjectSchema: S;\n}): Promise<\n  | {\n      valueID: string;\n      valueHint?: string;\n      inviteSecret: InviteSecret;\n    }\n  | undefined\n> {\n  return new Promise((resolve, reject) => {\n    const result = parseInviteLink(inviteURL);\n\n    if (result && result.valueHint === forValueHint) {\n      as.acceptInvite(result.valueID, result.inviteSecret, invitedObjectSchema)\n        .then(() => {\n          resolve(result);\n        })\n        .catch(reject);\n    } else {\n      resolve(undefined);\n    }\n  });\n}\n","export * from \"./exports.js\";\n\nexport { MAX_RECOMMENDED_TX_SIZE, cojsonInternals } from \"cojson\";\n"],"mappings":"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","names":["cojsonInternals","cojsonInternals","cojsonInternals"]}